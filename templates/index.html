{% include "templates.html" %} {% block content %}
<!-- Konten Tengah -->
<div class="main-content">
  <div class="text-center">
    <input
      type="text"
      class="search-bar"
      placeholder="Search Product here..."
    />
  </div>

  <!-- Category Menu -->
  <div class="category-container">
    {% for cat in data.categories %}
    <div
      class="category-card"
      onclick="filterProducts({{ cat['id'] }})"
      id="cat-{{ cat['id'] }}"
    >
      <img
        src=""
        alt="{{ cat['name'] }}"
        data-default="{{ url_for('static', filename='img/' + cat['image_url']) }}"
        data-hover="{{ url_for('static', filename='img/' + cat['hover_image_url']) }}"
      />
      <div class="category-info">
        <h4>{{ cat['name'] }}</h4>
        <p>{{ cat['total_products'] }} items</p>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Product Grid -->
  <div class="product-grid" id="product-container"></div>

  <div class="sidebar-right">
    <!-- Customer Name -->
    <div>
      <h5 class="d-flex justify-content-between align-items-center">
        <b>Customer Name</b>
        <img
          src="{{ url_for('static', filename='img/logo-edit.svg') }}"
          alt="Edit"
          width="20"
        />
      </h5>

      <hr class="custom-garis" />

      <div class="order-list"></div>
    </div>

    <!-- Order Summary -->
    <div>
      <div class="order-summary">
        <p>Sub Total <span class="float-end" id="subtotal"></span></p>
        <p>Tax 5% <span class="float-end">Rp. 6.075</span></p>
        <hr />
        <h5><b>Total Amount</b> <span class="float-end">Rp. 127.591</span></h5>
      </div>

      <!-- Payment Methods -->
      <div class="d-flex justify-content-center gap-3">
        <!-- Cash -->
        <div class="payment-option">
          <img
            src="{{ url_for('static', filename='img/cash-pay.svg') }}"
            alt="Cash"
            class="payment-img"
          />
          <p class="mt-2 mb-0">Cash</p>
        </div>
        <!-- Card/Debit -->
        <div class="payment-option">
          <img
            src="{{ url_for('static', filename='img/debit-pay.svg') }}"
            alt="Card"
            class="payment-img"
          />
          <p class="mt-2 mb-0">Card/Debit Card</p>
        </div>
        <!-- QR Code -->
        <div class="payment-option">
          <img
            src="{{ url_for('static', filename='img/qr-pay.svg') }}"
            alt="QR Code"
            class="payment-img"
          />
          <p class="mt-2 mb-0">QR Code</p>
        </div>
      </div>

      <!-- Place Order Button -->
      <button class="btn-order mt-3">Place Order</button>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
    const allProducts = {{ data.products | tojson }};  // Produk dikirim dari backend
  const cart = {}; // Objek untuk menyimpan belanjaan

  function changeImage(element, newSrc) {
    element.querySelector("img").src = newSrc;
  }

  function filterProducts(categoryId) {
      const productContainer = document.getElementById("product-container");
      productContainer.innerHTML = "";

      const selectedProducts = allProducts[categoryId] || [];

      selectedProducts.forEach(product => {
          const quantity = cart[product.name]?.quantity || 0;

          productContainer.innerHTML += `
              <div class="product-card">
                  <img src="/static/img/${product.image_url}" alt="${product.name}" />
                  <div class="product-info">
                      <h5>${product.name}</h5>
                      <p>Rp. ${parseInt(product.price).toLocaleString("id-ID").replace(/,/g, ".")}</p>
                  </div>
                  ${
                      quantity > 0
                          ? `<div class="counter">
                                <button class="decrease" data-name="${product.name}" data-category="${categoryId}">-</button>
                                <span class="quantity">${quantity}</span>
                                <button class="increase" data-name="${product.name}" data-category="${categoryId}">+</button>
                             </div>`
                          : `<div class="add-btn"
                                data-name="${product.name}"
                                data-price="${product.price}"
                                data-image="${product.image_url}"
                                data-category="${categoryId}">
                                Add to Dish
                             </div>`
                  }
              </div>`;
      });

      document.querySelectorAll(".category-card").forEach(el => {
        el.classList.remove("active");
        // Kembalikan gambar ke default jika tidak aktif
        const img = el.querySelector("img");
        img.src = img.getAttribute("data-default");
      });
      // Tambahkan class active ke kategori yang dipilih
      const activeCard = document.getElementById(`cat-${categoryId}`);
      activeCard.classList.add("active");

      // Ubah gambar ke hover_image_url saat aktif
      const activeImg = activeCard.querySelector("img");
      activeImg.src = activeImg.getAttribute("data-hover");

      updateOrderList();
  }

  // Menambahkan event listener untuk hover
  document.querySelectorAll(".category-card").forEach(card => {
    const img = card.querySelector("img");

    card.addEventListener("mouseover", function () {
        if (!this.classList.contains("active")) {
            img.src = img.getAttribute("data-hover");
        }
    });

    card.addEventListener("mouseout", function () {
        if (!this.classList.contains("active")) {
            img.src = img.getAttribute("data-default");
        }
    });
  });

  // Pilih kategori "All" saat halaman pertama kali dimuat
  document.addEventListener("DOMContentLoaded", function () {
      filterProducts(0);
  });

  // Event delegation untuk Add to Dish
  document.getElementById("product-container").addEventListener("click", function (e) {
      if (e.target.classList.contains("add-btn")) {
          const name = e.target.dataset.name;
          const price = parseFloat(e.target.dataset.price);
          const image = e.target.dataset.image;

          if (!cart[name]) {
              cart[name] = { quantity: 1, price, image };
          }

          filterProducts(document.querySelector(".category-card.active").id.replace("cat-", ""));
          updateOrderList();
      }
  });

  // Event delegation untuk increase dan decrease
  document.getElementById("product-container").addEventListener("click", function (e) {
      if (e.target.classList.contains("increase")) {
          const name = e.target.dataset.name;
          cart[name].quantity += 1;
          updateOrderList();
          filterProducts(document.querySelector(".category-card.active").id.replace("cat-", ""));
      }

      if (e.target.classList.contains("decrease")) {
          const name = e.target.dataset.name;
          if (cart[name].quantity > 1) {
              cart[name].quantity -= 1;
          } else {
              delete cart[name];
          }
          updateOrderList();
          filterProducts(document.querySelector(".category-card.active").id.replace("cat-", ""));
      }
  });

  function updateOrderList() {
      const orderList = document.querySelector(".order-list");
      orderList.innerHTML = "";

      let totalPrice = 0;

      Object.keys(cart).forEach(name => {
          const item = cart[name];
          const totalItemPrice = item.price * item.quantity;
          totalPrice += totalItemPrice;

          orderList.innerHTML += `
              <div class="order-item d-flex align-items-start">
                  <img src="/static/img/${item.image}" alt="${name}" />
                  <div class="flex-grow-1 d-flex flex-column gap-2">
                      <div class="d-flex justify-content-between align-items-start">
                          <b class="order-title">${name}</b>
                          <small class="text-muted">Rp. ${item.price.toLocaleString("id-ID").replace(/,/g, ".")}</small>
                      </div>
                      <div class="d-flex justify-content-between align-items-end">
                          <small>${item.quantity}x</small>
                          <strong class="price">Rp. ${totalItemPrice.toLocaleString("id-ID").replace(/,/g, ".")}</strong>
                      </div>
                  </div>
              </div>`;
      });

      if (totalPrice > 0) {
        const subtotal = document.getElementById("subtotal");
        subtotal.textContent = `Rp. ${totalPrice.toLocaleString("id-ID").replace(/,/g, ".")}`;
      } else {
          const subtotal = document.getElementById("subtotal");
          subtotal.textContent = "Rp. 0";
      }

  }
</script>
{% endblock %}
